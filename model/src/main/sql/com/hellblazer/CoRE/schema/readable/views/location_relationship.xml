<?xml version="1.0" encoding="UTF-8"?>

<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
    http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-2.0.xsd">

    <changeSet id="1" author="hhildebrand">
        <sql><![CDATA[
            CREATE OR REPLACE VIEW readable.location_relationship AS 
			 SELECT lr.id, c.name AS context, rel.name AS relationship, tc.name AS target_context, b.name AS product_mapped_value, lr.sequence_number, la1.name AS location_1_attribute, att_rel.name AS attribute_relationship, la2.name AS location_2_attribute, res.name AS updated_by, lr.update_date
			   FROM ruleform.location_relationship lr
			   JOIN ruleform.location_context c ON lr.context = c.id
			   JOIN ruleform.relationship rel ON lr.relationship = rel.id
			   JOIN ruleform.location_context tc ON lr.target_context = tc.id
			   JOIN ruleform.product b ON lr.product_mapped_value = b.id
			   JOIN ruleform.attribute la1 ON lr.location_1_attribute = la1.id
			   JOIN ruleform.relationship att_rel ON lr.attribute_relationship = att_rel.id
			   JOIN ruleform.attribute la2 ON lr.location_2_attribute = la2.id
			   JOIN ruleform.resource res ON lr.updated_by = res.id;
			
			ALTER TABLE readable.location_relationship
			  OWNER TO core;
            ]]>
        </sql>
        <rollback>
            <dropView viewName="readable.location_relationship" />
        </rollback>
    </changeSet>
</databaseChangeLog>
