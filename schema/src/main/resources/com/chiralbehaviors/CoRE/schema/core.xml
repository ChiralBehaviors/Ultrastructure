<?xml version="1.0" encoding="UTF-8"?>

<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
    http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd"
>

    <!-- Tag so we can roll back the change of the db creation -->
    <changeSet author="hhildebrand" id="tag_create-2.0.0">
        <tagDatabase tag="initial-schema-create" />
    </changeSet>
    
    <changeSet id="install uuid-ossp" author="hhildebrand">
        <sql>
            CREATE EXTENSION IF NOT EXISTS "uuid-ossp"
        </sql>
    </changeSet>
    <include relativeToChangelogFile="true" file="schemas.xml" />
    
    <changeSet id="revoke-super-${create.db.role}-2.0.0" author="hhildebrand" context="local">
        <sql><![CDATA[
            ALTER ROLE ${create.db.role} SET search_path TO ruleform, public, readable
            ]]>
        </sql>
    </changeSet>
    
    <include relativeToChangelogFile="true" file="ruleform/ruleform.xml" />
    <include relativeToChangelogFile="true" file="readable/readable.xml" />
    <include relativeToChangelogFile="true" file="revoke-super.xml" />
 
    <changeSet author="hhildebrand" id="tag-version-2.0.0">
        <tagDatabase tag="2.0.0" />
    </changeSet>

</databaseChangeLog>
