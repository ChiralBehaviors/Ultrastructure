<?xml version="1.0" encoding="UTF-8"?>

<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
    http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd">
    <include relativeToChangelogFile="true"
        file="0.0.2-rc1/ruleform/functions" />
    <changeSet id="workspace authorization" author="hhildebrand">
        <createProcedure encoding="utf8" procedureName="null_zero"
            schemaName="ruleform"><![CDATA[
            CREATE OR REPLACE FUNCTION null_zero(thing anyelement)
              RETURNS integer AS
            $BODY$
            SELECT CASE WHEN $1 IS NULL THEN 0 ELSE 1 END;
            $BODY$
              LANGUAGE sql VOLATILE
              COST 100;
        ]]>
        </createProcedure>
        <createTable schemaName="ruleform"
            remarks="A workspace authorization defines the entities in a workspace"
            tableName="workspace_authorization">
            <column name="id" type="CHAR(22)">
                <constraints primaryKey="true"
                    primaryKeyName="workspace_authorization_pkey" />
            </column>
            <column name="notes" type="VARCHAR(10485760)" />
            <column name="defining_product" type="CHAR(22)">
                <constraints nullable="false" />
            </column>
            <column name="type" type="VARCHAR(256)">
                <constraints nullable="false" />
            </column>
            <column name="updated_by" defaultValue="AAAAAAAAAAAAAAAAAAAAAQ"
                type="CHAR(22)">
                <constraints nullable="false" />
            </column>
            <column defaultValueComputed="('now'::text)::timestamp(6) with time zone"
                name="update_date" type="TIMESTAMPTZ">
                <constraints nullable="false" />
            </column>
            <column name="key" type="VARCHAR(1024)">
                <constraints nullable="false" />
            </column>
            <column name="agency" type="CHAR(22)" />
            <column name="agency_attribute" type="CHAR(22)" />
            <column name="agency_attribute_authorization" type="CHAR(22)" />
            <column name="agency_location" type="CHAR(22)" />
            <column name="agency_location_attribute" type="CHAR(22)" />
            <column name="agency_network" type="CHAR(22)" />
            <column name="agency_network_attribute" type="CHAR(22)" />
            <column name="agency_network_authorization" type="CHAR(22)" />
            <column name="agency_product" type="CHAR(22)" />
            <column name="agency_location_access_authorization"
                type="CHAR(22)" />
            <column name="agency_product_access_authorization"
                type="CHAR(22)" />
            <column name="attribute" type="CHAR(22)" />
            <column name="attribute_meta_attribute" type="CHAR(22)" />
            <column name="attr_meta_attr_auth" type="CHAR(22)" />
            <column name="attribute_network" type="CHAR(22)" />
            <column name="attribute_network_attribute" type="CHAR(22)" />
            <column name="unit" type="CHAR(22)" />
            <column name="unit_attribute" type="CHAR(22)" />
            <column name="unit_attribute_authorization" type="CHAR(22)" />
            <column name="unit_network" type="CHAR(22)" />
            <column name="unit_network_attribute" type="CHAR(22)" />
            <column name="unit_value" type="CHAR(22)" />
            <column name="location" type="CHAR(22)" />
            <column name="location_attribute" type="CHAR(22)" />
            <column name="location_attribute_authorization" type="CHAR(22)" />
            <column name="location_network" type="CHAR(22)" />
            <column name="location_network_attribute" type="CHAR(22)" />
            <column name="location_network_authorization" type="CHAR(22)" />
            <column name="product" type="CHAR(22)" />
            <column name="product_attribute" type="CHAR(22)" />
            <column name="product_attribute_authorization" type="CHAR(22)" />
            <column name="product_network" type="CHAR(22)" />
            <column name="product_network_attribute" type="CHAR(22)" />
            <column name="product_location" type="CHAR(22)" />
            <column name="product_location_attribute" type="CHAR(22)" />
            <column name="interval" type="CHAR(22)" />
            <column name="interval_attribute" type="CHAR(22)" />
            <column name="interval_attribute_authorization" type="CHAR(22)" />
            <column name="interval_network" type="CHAR(22)" />
            <column name="interval_network_attribute" type="CHAR(22)" />
            <column name="status_code" type="CHAR(22)" />
            <column name="status_code_attribute" type="CHAR(22)" />
            <column name="status_code_attribute_authorization"
                type="CHAR(22)" />
            <column name="status_code_network" type="CHAR(22)" />
            <column name="status_code_network_attribute" type="CHAR(22)" />
            <column name="status_code_sequencing" type="CHAR(22)" />
            <column name="job" type="CHAR(22)" />
            <column name="job_chronology" type="CHAR(22)" />
            <column name="meta_protocol" type="CHAR(22)" />
            <column name="product_child_sequencing_authorization"
                type="CHAR(22)" />
            <column name="product_parent_sequencing_authorization"
                type="CHAR(22)" />
            <column name="product_sibling_sequencing_authorization"
                type="CHAR(22)" />
            <column name="product_self_sequencing_authorization"
                type="CHAR(22)" />
            <column name="protocol" type="CHAR(22)" />
        </createTable>
        <addUniqueConstraint columnNames="defining_product, key"
            tableName="workspace_authorization" schemaName="ruleform" />
        <addForeignKeyConstraint
            baseTableSchemaName="ruleform " referencedTableSchemaName="ruleform"
            baseColumnNames="agency" baseTableName="workspace_authorization"
            constraintName="workspace_authorization_agency_fkey"
            deferrable="true" initiallyDeferred="true" onDelete="SET NULL"
            onUpdate="CASCADE" referencedColumnNames="id"
            referencedTableName="agency" />
        <addForeignKeyConstraint
            baseTableSchemaName="ruleform " referencedTableSchemaName="ruleform"
            baseColumnNames="agency_attribute" baseTableName="workspace_authorization"
            constraintName="workspace_authorization_agency_attribute_fkey"
            deferrable="true" initiallyDeferred="true" onDelete="SET NULL"
            onUpdate="CASCADE" referencedColumnNames="id"
            referencedTableName="agency_attribute" />
        <addForeignKeyConstraint
            baseTableSchemaName="ruleform " referencedTableSchemaName="ruleform"
            baseColumnNames="agency_attribute_authorization"
            baseTableName="workspace_authorization"
            constraintName="workspace_authorization_agency_attribute_authorization_fkey"
            deferrable="true" initiallyDeferred="true" onDelete="SET NULL"
            onUpdate="CASCADE" referencedColumnNames="id"
            referencedTableName="agency_attribute_authorization" />
        <addForeignKeyConstraint
            baseTableSchemaName="ruleform " referencedTableSchemaName="ruleform"
            baseColumnNames="agency_location" baseTableName="workspace_authorization"
            constraintName="workspace_authorization_agency_location_fkey"
            deferrable="true" initiallyDeferred="true" onDelete="SET NULL"
            onUpdate="CASCADE" referencedColumnNames="id"
            referencedTableName="agency_location" />
        <addForeignKeyConstraint
            baseTableSchemaName="ruleform " referencedTableSchemaName="ruleform"
            baseColumnNames="agency_location_attribute" baseTableName="workspace_authorization"
            constraintName="workspace_authorization_agency_location_attribute_fkey"
            deferrable="true" initiallyDeferred="true" onDelete="SET NULL"
            onUpdate="CASCADE" referencedColumnNames="id"
            referencedTableName="agency_location_attribute" />
        <addForeignKeyConstraint
            baseTableSchemaName="ruleform " referencedTableSchemaName="ruleform"
            baseColumnNames="agency_network" baseTableName="workspace_authorization"
            constraintName="workspace_authorization_agency_network_fkey"
            deferrable="true" initiallyDeferred="true" onDelete="SET NULL"
            onUpdate="CASCADE" referencedColumnNames="id"
            referencedTableName="agency_network" />
        <addForeignKeyConstraint
            baseTableSchemaName="ruleform " referencedTableSchemaName="ruleform"
            baseColumnNames="agency_network_attribute" baseTableName="workspace_authorization"
            constraintName="workspace_authorization_agency_network_attribute_fkey"
            deferrable="true" initiallyDeferred="true" onDelete="SET NULL"
            onUpdate="CASCADE" referencedColumnNames="id"
            referencedTableName="agency_network_attribute" />
        <addForeignKeyConstraint
            baseTableSchemaName="ruleform " referencedTableSchemaName="ruleform"
            baseColumnNames="agency_network_authorization"
            baseTableName="workspace_authorization"
            constraintName="workspace_authorization_agency_network_authorization_fkey"
            deferrable="true" initiallyDeferred="true" onDelete="SET NULL"
            onUpdate="CASCADE" referencedColumnNames="id"
            referencedTableName="agency_network_authorization" />
        <addForeignKeyConstraint
            baseTableSchemaName="ruleform " referencedTableSchemaName="ruleform"
            baseColumnNames="agency_product" baseTableName="workspace_authorization"
            constraintName="workspace_authorization_agency_product_fkey"
            deferrable="true" initiallyDeferred="true" onDelete="SET NULL"
            onUpdate="CASCADE" referencedColumnNames="id"
            referencedTableName="agency_product" />
        <addForeignKeyConstraint
            baseTableSchemaName="ruleform " referencedTableSchemaName="ruleform"
            baseColumnNames="attribute" baseTableName="workspace_authorization"
            constraintName="workspace_authorization_attribute_fkey"
            deferrable="true" initiallyDeferred="true" onDelete="SET NULL"
            onUpdate="CASCADE" referencedColumnNames="id"
            referencedTableName="attribute" />
        <addForeignKeyConstraint
            baseTableSchemaName="ruleform " referencedTableSchemaName="ruleform"
            baseColumnNames="attribute_meta_attribute" baseTableName="workspace_authorization"
            constraintName="workspace_authorization_attribute_meta_attribute_fkey"
            deferrable="true" initiallyDeferred="true" onDelete="SET NULL"
            onUpdate="CASCADE" referencedColumnNames="id"
            referencedTableName="attribute_meta_attribute" />
        <addForeignKeyConstraint
            baseTableSchemaName="ruleform " referencedTableSchemaName="ruleform"
            baseColumnNames="attr_meta_attr_auth" baseTableName="workspace_authorization"
            constraintName="workspace_authorization_attr_meta_attr_auth_fkey"
            deferrable="true" initiallyDeferred="true" onDelete="SET NULL"
            onUpdate="CASCADE" referencedColumnNames="id"
            referencedTableName="attr_meta_attr_auth" />
        <addForeignKeyConstraint
            baseTableSchemaName="ruleform " referencedTableSchemaName="ruleform"
            baseColumnNames="attribute_network" baseTableName="workspace_authorization"
            constraintName="workspace_authorization_attribute_network_fkey"
            deferrable="true" initiallyDeferred="true" onDelete="SET NULL"
            onUpdate="CASCADE" referencedColumnNames="id"
            referencedTableName="attribute_network" />
        <addForeignKeyConstraint
            baseTableSchemaName="ruleform " referencedTableSchemaName="ruleform"
            baseColumnNames="attribute_network_attribute" baseTableName="workspace_authorization"
            constraintName="workspace_authorization_attribute_network_attribute_fkey"
            deferrable="true" initiallyDeferred="true" onDelete="SET NULL"
            onUpdate="CASCADE" referencedColumnNames="id"
            referencedTableName="attribute_network_attribute" />
        <addForeignKeyConstraint
            baseTableSchemaName="ruleform " referencedTableSchemaName="ruleform"
            baseColumnNames="unit" baseTableName="workspace_authorization"
            constraintName="workspace_authorization_unit_fkey"
            deferrable="true" initiallyDeferred="true" onDelete="SET NULL"
            onUpdate="CASCADE" referencedColumnNames="id"
            referencedTableName="unit" />
        <addForeignKeyConstraint
            baseTableSchemaName="ruleform " referencedTableSchemaName="ruleform"
            baseColumnNames="unit_attribute" baseTableName="workspace_authorization"
            constraintName="workspace_authorization_unit_attribute_fkey"
            deferrable="true" initiallyDeferred="true" onDelete="SET NULL"
            onUpdate="CASCADE" referencedColumnNames="id"
            referencedTableName="unit_attribute" />
        <addForeignKeyConstraint
            baseTableSchemaName="ruleform " referencedTableSchemaName="ruleform"
            baseColumnNames="unit_attribute_authorization"
            baseTableName="workspace_authorization"
            constraintName="workspace_authorization_unit_attribute_authorization_fkey"
            deferrable="true" initiallyDeferred="true" onDelete="SET NULL"
            onUpdate="CASCADE" referencedColumnNames="id"
            referencedTableName="unit_attribute_authorization" />
        <addForeignKeyConstraint
            baseTableSchemaName="ruleform " referencedTableSchemaName="ruleform"
            baseColumnNames="unit_network" baseTableName="workspace_authorization"
            constraintName="workspace_authorization_unit_network_fkey"
            deferrable="true" initiallyDeferred="true" onDelete="SET NULL"
            onUpdate="CASCADE" referencedColumnNames="id"
            referencedTableName="unit_network" />
        <addForeignKeyConstraint
            baseTableSchemaName="ruleform " referencedTableSchemaName="ruleform"
            baseColumnNames="unit_network_attribute" baseTableName="workspace_authorization"
            constraintName="workspace_authorization_unit_network_attribute_fkey"
            deferrable="true" initiallyDeferred="true" onDelete="SET NULL"
            onUpdate="CASCADE" referencedColumnNames="id"
            referencedTableName="unit_network_attribute" />
        <addForeignKeyConstraint
            baseTableSchemaName="ruleform " referencedTableSchemaName="ruleform"
            baseColumnNames="unit_value" baseTableName="workspace_authorization"
            constraintName="workspace_authorization_unit_value_fkey"
            deferrable="true" initiallyDeferred="true" onDelete="SET NULL"
            onUpdate="CASCADE" referencedColumnNames="id"
            referencedTableName="unit_values" />
        <addForeignKeyConstraint
            baseTableSchemaName="ruleform " referencedTableSchemaName="ruleform"
            baseColumnNames="location" baseTableName="workspace_authorization"
            constraintName="workspace_authorization_location_fkey"
            deferrable="true" initiallyDeferred="true" onDelete="SET NULL"
            onUpdate="CASCADE" referencedColumnNames="id"
            referencedTableName="location" />
        <addForeignKeyConstraint
            baseTableSchemaName="ruleform " referencedTableSchemaName="ruleform"
            baseColumnNames="location_attribute" baseTableName="workspace_authorization"
            constraintName="workspace_authorization_location_attribute_fkey"
            deferrable="true" initiallyDeferred="true" onDelete="SET NULL"
            onUpdate="CASCADE" referencedColumnNames="id"
            referencedTableName="location_attribute" />
        <addForeignKeyConstraint
            baseTableSchemaName="ruleform " referencedTableSchemaName="ruleform"
            baseColumnNames="location_attribute_authorization"
            baseTableName="workspace_authorization"
            constraintName="workspace_authorization_location_attribute_authorization_fkey"
            deferrable="true" initiallyDeferred="true" onDelete="SET NULL"
            onUpdate="CASCADE" referencedColumnNames="id"
            referencedTableName="location_attribute_authorization" />
        <addForeignKeyConstraint
            baseTableSchemaName="ruleform " referencedTableSchemaName="ruleform"
            baseColumnNames="location_network" baseTableName="workspace_authorization"
            constraintName="workspace_authorization_location_network_fkey"
            deferrable="true" initiallyDeferred="true" onDelete="SET NULL"
            onUpdate="CASCADE" referencedColumnNames="id"
            referencedTableName="location_network" />
        <addForeignKeyConstraint
            baseTableSchemaName="ruleform " referencedTableSchemaName="ruleform"
            baseColumnNames="location_network_attribute" baseTableName="workspace_authorization"
            constraintName="workspace_authorization_location_network_attribute_fkey"
            deferrable="true" initiallyDeferred="true" onDelete="SET NULL"
            onUpdate="CASCADE" referencedColumnNames="id"
            referencedTableName="location_network_attribute" />
        <addForeignKeyConstraint
            baseTableSchemaName="ruleform " referencedTableSchemaName="ruleform"
            baseColumnNames="location_network_authorization"
            baseTableName="workspace_authorization"
            constraintName="workspace_authorization_location_network_authorization_fkey"
            deferrable="true" initiallyDeferred="true" onDelete="SET NULL"
            onUpdate="CASCADE" referencedColumnNames="id"
            referencedTableName="location_network_authorization" />
        <addForeignKeyConstraint
            baseTableSchemaName="ruleform " referencedTableSchemaName="ruleform"
            baseColumnNames="product" baseTableName="workspace_authorization"
            constraintName="workspace_authorization_product_fkey"
            deferrable="true" initiallyDeferred="true" onDelete="SET NULL"
            onUpdate="CASCADE" referencedColumnNames="id"
            referencedTableName="product" />
        <addForeignKeyConstraint
            baseTableSchemaName="ruleform " referencedTableSchemaName="ruleform"
            baseColumnNames="product_attribute" baseTableName="workspace_authorization"
            constraintName="workspace_authorization_product_attribute_fkey"
            deferrable="true" initiallyDeferred="true" onDelete="SET NULL"
            onUpdate="CASCADE" referencedColumnNames="id"
            referencedTableName="product_attribute" />
        <addForeignKeyConstraint
            baseTableSchemaName="ruleform " referencedTableSchemaName="ruleform"
            baseColumnNames="product_attribute_authorization"
            baseTableName="workspace_authorization"
            constraintName="workspace_authorization_product_attribute_authorization_fkey"
            deferrable="true" initiallyDeferred="true" onDelete="SET NULL"
            onUpdate="CASCADE" referencedColumnNames="id"
            referencedTableName="product_attribute_authorization" />
        <addForeignKeyConstraint
            baseTableSchemaName="ruleform " referencedTableSchemaName="ruleform"
            baseColumnNames="product_network" baseTableName="workspace_authorization"
            constraintName="workspace_authorization_product_network_fkey"
            deferrable="true" initiallyDeferred="true" onDelete="SET NULL"
            onUpdate="CASCADE" referencedColumnNames="id"
            referencedTableName="product_network" />
        <addForeignKeyConstraint
            baseTableSchemaName="ruleform " referencedTableSchemaName="ruleform"
            baseColumnNames="product_network_attribute" baseTableName="workspace_authorization"
            constraintName="workspace_authorization_product_network_attribute_fkey"
            deferrable="true" initiallyDeferred="true" onDelete="SET NULL"
            onUpdate="CASCADE" referencedColumnNames="id"
            referencedTableName="product_network_attribute" />
        <addForeignKeyConstraint
            baseTableSchemaName="ruleform " referencedTableSchemaName="ruleform"
            baseColumnNames="product_location" baseTableName="workspace_authorization"
            constraintName="workspace_authorization_product_location_fkey"
            deferrable="true" initiallyDeferred="true" onDelete="SET NULL"
            onUpdate="CASCADE" referencedColumnNames="id"
            referencedTableName="product_location" />
        <addForeignKeyConstraint
            baseTableSchemaName="ruleform " referencedTableSchemaName="ruleform"
            baseColumnNames="product_location_attribute" baseTableName="workspace_authorization"
            constraintName="workspace_authorization_product_location_attribute_fkey"
            deferrable="true" initiallyDeferred="true" onDelete="SET NULL"
            onUpdate="CASCADE" referencedColumnNames="id"
            referencedTableName="product_location_attribute" />
        <addForeignKeyConstraint
            baseTableSchemaName="ruleform " referencedTableSchemaName="ruleform"
            baseColumnNames="interval" baseTableName="workspace_authorization"
            constraintName="workspace_authorization_interval_fkey"
            deferrable="true" initiallyDeferred="true" onDelete="SET NULL"
            onUpdate="CASCADE" referencedColumnNames="id"
            referencedTableName="interval" />
        <addForeignKeyConstraint
            baseTableSchemaName="ruleform " referencedTableSchemaName="ruleform"
            baseColumnNames="interval_attribute" baseTableName="workspace_authorization"
            constraintName="workspace_authorization_interval_attribute_fkey"
            deferrable="true" initiallyDeferred="true" onDelete="SET NULL"
            onUpdate="CASCADE" referencedColumnNames="id"
            referencedTableName="interval_attribute" />
        <addForeignKeyConstraint
            baseTableSchemaName="ruleform " referencedTableSchemaName="ruleform"
            baseColumnNames="interval_attribute_authorization"
            baseTableName="workspace_authorization"
            constraintName="workspace_authorization_interval_attribute_authorization_fkey"
            deferrable="true" initiallyDeferred="true" onDelete="SET NULL"
            onUpdate="CASCADE" referencedColumnNames="id"
            referencedTableName="interval_attribute_authorization" />
        <addForeignKeyConstraint
            baseTableSchemaName="ruleform " referencedTableSchemaName="ruleform"
            baseColumnNames="interval_network" baseTableName="workspace_authorization"
            constraintName="workspace_authorization_interval_network_fkey"
            deferrable="true" initiallyDeferred="true" onDelete="SET NULL"
            onUpdate="CASCADE" referencedColumnNames="id"
            referencedTableName="interval_network" />
        <addForeignKeyConstraint
            baseTableSchemaName="ruleform " referencedTableSchemaName="ruleform"
            baseColumnNames="interval_network_attribute" baseTableName="workspace_authorization"
            constraintName="workspace_authorization_interval_network_attribute_fkey"
            deferrable="true" initiallyDeferred="true" onDelete="SET NULL"
            onUpdate="CASCADE" referencedColumnNames="id"
            referencedTableName="interval_network_attribute" />
        <addForeignKeyConstraint
            baseTableSchemaName="ruleform " referencedTableSchemaName="ruleform"
            baseColumnNames="status_code" baseTableName="workspace_authorization"
            constraintName="workspace_authorization_status_code_fkey"
            deferrable="true" initiallyDeferred="true" onDelete="SET NULL"
            onUpdate="CASCADE" referencedColumnNames="id"
            referencedTableName="status_code" />
        <addForeignKeyConstraint
            baseTableSchemaName="ruleform " referencedTableSchemaName="ruleform"
            baseColumnNames="status_code_attribute" baseTableName="workspace_authorization"
            constraintName="workspace_authorization_status_code_attribute_fkey"
            deferrable="true" initiallyDeferred="true" onDelete="SET NULL"
            onUpdate="CASCADE" referencedColumnNames="id"
            referencedTableName="status_code_attribute" />
        <addForeignKeyConstraint
            baseTableSchemaName="ruleform " referencedTableSchemaName="ruleform"
            baseColumnNames="status_code_attribute_authorization"
            baseTableName="workspace_authorization"
            constraintName="workspace_authorization_status_code_attribute_authorization_fkey"
            deferrable="true" initiallyDeferred="true" onDelete="SET NULL"
            onUpdate="CASCADE" referencedColumnNames="id"
            referencedTableName="status_code_attribute_authorization" />
        <addForeignKeyConstraint
            baseTableSchemaName="ruleform " referencedTableSchemaName="ruleform"
            baseColumnNames="status_code_network" baseTableName="workspace_authorization"
            constraintName="workspace_authorization_status_code_network_fkey"
            deferrable="true" initiallyDeferred="true" onDelete="SET NULL"
            onUpdate="CASCADE" referencedColumnNames="id"
            referencedTableName="status_code_network" />
        <addForeignKeyConstraint
            baseTableSchemaName="ruleform " referencedTableSchemaName="ruleform"
            baseColumnNames="status_code_network_attribute"
            baseTableName="workspace_authorization"
            constraintName="workspace_authorization_status_code_network_attribute_fkey"
            deferrable="true" initiallyDeferred="true" onDelete="SET NULL"
            onUpdate="CASCADE" referencedColumnNames="id"
            referencedTableName="status_code_network_attribute" />
        <addForeignKeyConstraint
            baseTableSchemaName="ruleform " referencedTableSchemaName="ruleform"
            baseColumnNames="status_code_sequencing" baseTableName="workspace_authorization"
            constraintName="workspace_authorization_status_code_sequencing_fkey"
            deferrable="true" initiallyDeferred="true" onDelete="SET NULL"
            onUpdate="CASCADE" referencedColumnNames="id"
            referencedTableName="status_code_sequencing" />
        <addForeignKeyConstraint
            baseTableSchemaName="ruleform " referencedTableSchemaName="ruleform"
            baseColumnNames="job" baseTableName="workspace_authorization"
            constraintName="workspace_authorization_job_fkey"
            deferrable="true" initiallyDeferred="true" onDelete="SET NULL"
            onUpdate="CASCADE" referencedColumnNames="id"
            referencedTableName="job" />
        <addForeignKeyConstraint
            baseTableSchemaName="ruleform " referencedTableSchemaName="ruleform"
            baseColumnNames="job_chronology" baseTableName="workspace_authorization"
            constraintName="workspace_authorization_job_chronology_fkey"
            deferrable="true" initiallyDeferred="true" onDelete="SET NULL"
            onUpdate="CASCADE" referencedColumnNames="id"
            referencedTableName="job_chronology" />
        <addForeignKeyConstraint
            baseTableSchemaName="ruleform " referencedTableSchemaName="ruleform"
            baseColumnNames="meta_protocol" baseTableName="workspace_authorization"
            constraintName="workspace_authorization_meta_protocol_fkey"
            deferrable="true" initiallyDeferred="true" onDelete="SET NULL"
            onUpdate="CASCADE" referencedColumnNames="id"
            referencedTableName="meta_protocol" />
        <addForeignKeyConstraint
            baseTableSchemaName="ruleform " referencedTableSchemaName="ruleform"
            baseColumnNames="product_child_sequencing_authorization"
            baseTableName="workspace_authorization"
            constraintName="workspace_authorization_product_child_sequencing_authorization_fkey"
            deferrable="true" initiallyDeferred="true" onDelete="SET NULL"
            onUpdate="CASCADE" referencedColumnNames="id"
            referencedTableName="product_child_sequencing_authorization" />
        <addForeignKeyConstraint
            baseTableSchemaName="ruleform " referencedTableSchemaName="ruleform"
            baseColumnNames="product_parent_sequencing_authorization"
            baseTableName="workspace_authorization"
            constraintName="workspace_authorization_product_parent_sequencing_authorization_fkey"
            deferrable="true" initiallyDeferred="true" onDelete="SET NULL"
            onUpdate="CASCADE" referencedColumnNames="id"
            referencedTableName="product_parent_sequencing_authorization" />
        <addForeignKeyConstraint
            baseTableSchemaName="ruleform " referencedTableSchemaName="ruleform"
            baseColumnNames="product_sibling_sequencing_authorization"
            baseTableName="workspace_authorization"
            constraintName="workspace_authorization_product_sibling_sequencing_authorization_fkey"
            deferrable="true" initiallyDeferred="true" onDelete="SET NULL"
            onUpdate="CASCADE" referencedColumnNames="id"
            referencedTableName="product_sibling_sequencing_authorization" />
        <addForeignKeyConstraint
            baseTableSchemaName="ruleform " referencedTableSchemaName="ruleform"
            baseColumnNames="protocol" baseTableName="workspace_authorization"
            constraintName="workspace_authorization_protocol_fkey"
            deferrable="true" initiallyDeferred="true" onDelete="SET NULL"
            onUpdate="CASCADE" referencedColumnNames="id"
            referencedTableName="protocol" />
        <addForeignKeyConstraint
            baseTableSchemaName="ruleform " referencedTableSchemaName="ruleform"
            baseColumnNames="updated_by" baseTableName="workspace_authorization"
            constraintName="workspace_authorization_updated_by_fkey"
            deferrable="true" initiallyDeferred="true" onDelete="SET DEFAULT"
            onUpdate="CASCADE" referencedColumnNames="id"
            referencedTableName="agency" />
        <addForeignKeyConstraint
            baseTableSchemaName="ruleform " referencedTableSchemaName="ruleform"
            baseColumnNames="defining_product" baseTableName="workspace_authorization"
            constraintName="workspace_authorization_defining_product_fkey"
            deferrable="true" initiallyDeferred="true" onDelete="CASCADE"
            onUpdate="CASCADE" referencedColumnNames="id"
            referencedTableName="product" />

        <createIndex schemaName="ruleform"
            indexName="workspace_authorization_updated_by_fkey_idx"
            tableName="agency" unique="false">
            <column name="updated_by" />
        </createIndex>
        <sql><![CDATA[
            ALTER TABLE ruleform.workspace_authorization ADD CONSTRAINT
            wsa_single_reference CHECK((
                ruleform.null_zero(agency) +
                ruleform.null_zero(agency_attribute) +
                ruleform.null_zero(agency_attribute_authorization) +
                ruleform.null_zero(agency_location) +
                ruleform.null_zero(agency_location_attribute) +
                ruleform.null_zero(agency_network) +
                ruleform.null_zero(agency_network_attribute) +
                ruleform.null_zero(agency_network_authorization) +
                ruleform.null_zero(agency_product) +
                ruleform.null_zero(agency_location_access_authorization) +
                ruleform.null_zero(agency_product_access_authorization) +
                ruleform.null_zero(attribute) +
                ruleform.null_zero(attribute_meta_attribute) +
                ruleform.null_zero(attr_meta_attr_auth) +
                ruleform.null_zero(attribute_network) +
                ruleform.null_zero(attribute_network_attribute) +
                ruleform.null_zero(unit) +
                ruleform.null_zero(unit_attribute) +
                ruleform.null_zero(unit_attribute_authorization) +
                ruleform.null_zero(unit_network) +
                ruleform.null_zero(unit_network_attribute) +
                ruleform.null_zero(unit_value) +
                ruleform.null_zero(location) +
                ruleform.null_zero(location_attribute) +
                ruleform.null_zero(location_attribute_authorization) +
                ruleform.null_zero(location_network) +
                ruleform.null_zero(location_network_attribute) +
                ruleform.null_zero(location_network_authorization) +
                ruleform.null_zero(product) +
                ruleform.null_zero(product_attribute) +
                ruleform.null_zero(product_attribute_authorization) +
                ruleform.null_zero(product_network) +
                ruleform.null_zero(product_network_attribute) +
                ruleform.null_zero(product_location) +
                ruleform.null_zero(product_location_attribute) +
                ruleform.null_zero(interval) +
                ruleform.null_zero(interval_attribute) +
                ruleform.null_zero(interval_attribute_authorization) +
                ruleform.null_zero(interval_network) +
                ruleform.null_zero(interval_network_attribute) +
                ruleform.null_zero(status_code) +
                ruleform.null_zero(status_code_attribute) +
                ruleform.null_zero(status_code_attribute_authorization) +
                ruleform.null_zero(status_code_network) +
                ruleform.null_zero(status_code_network_attribute) +
                ruleform.null_zero(status_code_sequencing) +
                ruleform.null_zero(job) +
                ruleform.null_zero(job_chronology) +
                ruleform.null_zero(meta_protocol) +
                ruleform.null_zero(product_child_sequencing_authorization) +
                ruleform.null_zero(product_parent_sequencing_authorization) +
                ruleform.null_zero(product_sibling_sequencing_authorization) +
                ruleform.null_zero(protocol)
                ) = 1)
        ]]>
        </sql>
    </changeSet>
    <changeSet id="Job depth limit" author="hhildebrand">
        <addColumn tableName="job" schemaName="ruleform">
            <column name="depth" type="SMALLINT" />
        </addColumn>
        <createView viewName="job" schemaName="readable"
            replaceIfExists="true"><![CDATA[
             SELECT base_table.id, 
                    base_table.depth,
                    s.name AS service, 
                    r.name AS requester, 
                    p.name AS product,  
                    dt.name AS deliver_to, 
                    df.name AS deliver_from, 
                    at.name AS assign_to,
                    sc.name AS status, 
                    base_table.quantity,
                    u.name AS quantity_unit,
                    base_table.parent, 
                    ra.name AS requester_attribute,
                    sa.name AS service_attribute,
                    pa.name AS product_attribute,
                    dta.name AS deliver_to_attribute,
                    dfa.name AS deliver_from_attribute,
                    ata.name AS assign_to_attribute,
                    base_table.sequence_number,
                    base_table.notes, 
                    base_table.current_log_sequence,
                    up.name AS updated_by, base_table.update_date,
                    base_table.protocol
               FROM job base_table
               JOIN product s ON base_table.service = s.id
               JOIN product p ON base_table.product = p.id
               JOIN agency at ON base_table.assign_to = at.id
               JOIN agency r ON base_table.requester = r.id
               JOIN location dt ON base_table.deliver_to = dt.id
               JOIN location df ON base_table.deliver_from = df.id
               JOIN status_code sc ON base_table.status = sc.id
               JOIN agency up ON base_table.updated_by = up.id
               JOIN attribute ra ON base_table.requester_attribute = ra.id
               JOIN attribute sa ON base_table.service_attribute = sa.id
               JOIN attribute pa ON base_table.product_attribute = pa.id
               JOIN attribute dta ON base_table.deliver_to_attribute = dta.id
               JOIN attribute dfa ON base_table.deliver_from_attribute = dfa.id
               JOIN unit u ON base_table.quantity_unit = u.id
               JOIN attribute ata ON base_table.assign_to_attribute = ata.id;
        ]]>
        </createView>
    </changeSet>
</databaseChangeLog>