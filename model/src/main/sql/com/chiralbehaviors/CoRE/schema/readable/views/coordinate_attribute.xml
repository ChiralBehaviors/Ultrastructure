<?xml version="1.0" encoding="UTF-8"?>

<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
    http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.0.xsd">

    <changeSet id="1" author="hhildebrand">
        <sql><![CDATA[
            CREATE OR REPLACE VIEW readable.coordinate_attribute AS 
			 SELECT ca.id, 
			     c.name AS coordinate, 
			     a.name AS attribute,
			     bv.name AS product_value, 
			     ca.integer_value, 
			     ca.numeric_value, 
			     ca.boolean_value, 
			     ca.text_value, 
			     ca.notes,
			     up.name AS updated_by, 
			     ca.update_date
			   FROM ruleform.coordinate_attribute ca
			   JOIN ruleform.coordinate c ON c.id = ca.coordinate
			   JOIN ruleform.attribute a ON a.id = ca.attribute
			   LEFT JOIN ruleform.product bv ON bv.id = ca.product_value
			   JOIN ruleform.agency up ON up.id = ca.updated_by;
			
			ALTER TABLE readable.coordinate_attribute
			  OWNER TO core;
			GRANT ALL ON TABLE readable.coordinate_attribute TO core;
			GRANT SELECT ON TABLE readable.coordinate_attribute TO public;
            ]]>
        </sql>
        <rollback>
            <dropView viewName="readable.coordinate_attribute" />
        </rollback>
    </changeSet>
</databaseChangeLog>
